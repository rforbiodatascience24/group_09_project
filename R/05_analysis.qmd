---
title: "05_analysis"
format: html
editor: visual
---

# Microbial distribution across BMI classes

```{r}
library(tidyverse)
library(vegan)
```

```{r}
# verify that the dataset can be loaded successfully
data_path <- "../data/06_dat_augmented.csv"
dataset <- read_csv(data_path,
                    show_col_types = FALSE)
# random comment
```

Null hypothesis : There is no difference in microbial community across composition across the BMI classes Alternative hypothesis: There is a difference in microbial community composition across BMI classes.

We categorize BMI into 4 groups : Normal weight,overweight,underweight and Obese.

```{r}
#Loading the dataset

data_path <- "../data/06_dat_augmented.csv"
dataset <- read_csv(data_path,
                    show_col_types = FALSE)
view(dataset)
```


```{r}
#splitting dataset into metadata and bacteria data 
metadata <- dataset |> 
  select(-starts_with("s_")) 

bacteria_data <- dataset |> 
  select(starts_with("s_")) 
```

```{r}
#  Bray-Curtis distances.

bc_distance <- vegdist(bacteria_data,
                   method = "bray")
```

```{r}
# applying (PCoA) to visualize clusters of bacteria.

pcoa_result <- cmdscale(bc_distance, k = 2)  
```

```{r}
#PCoA with BMI to visualize clusters across BMI
pcoa_df <- data.frame(pcoa_result,
                      Group = metadata$BMI_class) |> 
  rename(PCoA1 = X1,
         PCoA2 = X2)


```

```{r}
 ggplot(pcoa_df,
       aes(x = PCoA1,
           y = PCoA2,
           color = Group)) +
    geom_point(size = 3,
             alpha = 0.5) +  
    theme_minimal() +  
    labs(title = "PCoA Plot of Beta Diversity", 
       x = "PCoA1", 
       y = "PCoA2",
       color = "BMI Category")
```

```{r}
 # PERMANOVA to  see whether the diversity of microbial communities differ across bmi
anova_result <- adonis2(bc_distance ~ BMI_class,
                         data = metadata)
print(anova_result)
```

## Interpretation of the results

From the PCoA plot we can see that there aren't clusters for each BMI category and some samples overlap with samples from different categories such as points from normal weight overlap with obese and overweight. The P.value from PERMANOVA is 0.2 which indicates that the differences in microbial composition is not significant.Also R2=0.0238 which means that bmi contributes to only 2.38% of the difference in diversity of microbial community across the bmi classes.
