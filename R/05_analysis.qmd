---
title: "05_analysis"
format: html
editor: visual
---

# Microbial distribution across BMI classes

```{r}
library(tidyverse)
library(vegan)
```

Null hypothesis : There is no difference in microbial community across composition across the BMI classes Alternative hypothesis: There is a difference in microbial community composition across BMI classes.

We categorize BMI into 4 groups : Normal weight,overweight,underweight and Obese.

```{r}
#Loading the dataset
# verify that the dataset can be loaded successfully
data_path <- "../data/06_dat_augmented.csv"
dataset <- read_csv(data_path,
                    show_col_types = FALSE)
```

```{r}
# Step 1: Split the dataset into metadata and species abundance data.
# Keeping only metadata (non-species columns).
metadata <- dataset |> 
  select(-starts_with("s_")) 
# Keeping only the species abundance data (columns starting with "s_").
data <- dataset |> 
  select(starts_with("s_")) 
```

```{r}
# Step 2: Calculate Bray-Curtis distances.
# This distance measures how similar (or different) the microbial communities are.
bc_dist <- vegdist(data,
                   method = "bray")
```

```{r}
# Step 3: Perform Principal Coordinate Analysis (PCoA).
# I use cmdscale for this, which computes a 2D representation of the Bray-Curtis distances.
pcoa_result <- cmdscale(bc_dist, k = 2)  
```

```{r}
# Step 4: Combine the PCoA results with the metadata (BMI class) so I can label the samples by BMI_class.
pcoa_df <- data.frame(pcoa_result,
                      Group = metadata$BMI_class) |> 
  rename(PCoA1 = X1,
         PCoA2 = X2)
```

```{r}
# Step 5: Visualize the PCoA results using a scatter plot.
# This helps us see how BMI groups (e.g., underweight, normal, obese) cluster based on microbial composition.

ggplot(pcoa_df,
       aes(x = PCoA1,
           y = PCoA2,
           color = Group)) +
  geom_point(size = 3,
             alpha = 0.8) +  
  theme_minimal() +  
  labs(title = "PCoA Plot of Beta Diversity (Bray-Curtis)", 
       x = "PCoA1", 
       y = "PCoA2",
       color = "BMI Category")
```

```{r}
 #Step 6: Run PERMANOVA to test for statistically significant differences between BMI groups.
# This statistical test checks if microbial composition is significantly different between BMI categories.
adonis_result <- adonis2(bc_dist ~ BMI_class,
                         data = metadata)
print(adonis_result)
```

## Interpretation of the results

From the PCoA plot we can see that there aren't clusters for each BMI category and some samples overlap with samples from different categories such as points from normal weight overlap with obese and overweight. The P.value from PERMANOVA is 0.2 whcich indicates that the differences in microbial composition is not significant.Also R2=0.0238 which means that bmi contributes to only 2.38% of the difference in diversity of microbial community across the bmi classes.
